---
title: "US Cities"
output: html_document
date: "2024-06-10"
---

https://spatialreference.org/ 
https://spatialreference.org/ref/epsg/4326/

devtools::install_github('jgcri/rgis')

```{r}
install.packages("devtools")
install.packages("sf")

install.packages("USAboundaries", repos = "https://ropensci.r-universe.dev", type = "source")
install.packages("USAboundariesData", repos = "https://ropensci.r-universe.dev", type = "source")

#OR
install.packages("devtools")
devtools::install_github("ropensci/USAboundaries")
devtools::install_github("ropensci/USAboundariesData")

#OR
install.packages("USAboundaries")
```

```{r}
library(tidyverse)
library(sf)
library(USAboundaries)
library(USAboundariesData)
library(dplyr)
library(lubridate)
```

```{r}
states <- us_states()

lower_48 <- states %>% filter(name %in% state.name, name != "Hawaii", name != "Alaska", name != "Puerto Rico")

us_cities <- us_cities() %>%
  filter(!(state_name %in% c("Alaska", "Hawaii"))) %>%
  mutate(population = sample(1:1000000, n(), replace = TRUE))

us_cities_top3 <- us_cities %>%
  group_by(state_name) %>%
  arrange(desc(population)) %>%  # Arrange by population in descending order
  slice(1:3) %>%  # Select the top 3 cities by population
  mutate(index = case_when(
    row_number() == 1 ~ 1,
    row_number() == 2 ~ 2,
    row_number() == 3 ~ 3
  ))
  
id_counties <- us_counties(states ="Idaho")

ggplot() +
  geom_sf(data = lower_48, fill = "white") +  # Outline of states
  geom_sf(data = id_counties, fill = "white", color = "black") +  # Counties as base layer
  # geom_sf(data = us_states, aes(fill = name), color = "black") +  # States with fill based on state name
  geom_sf(data = us_cities_top3, aes(color = population), size = 3)   # Cities with color based on population
```


```{r}
ggplot() +
  geom_sf(data = lower_48, aes(fill = "white", color = "black"), size = 0.5) +  # Outline of states
  geom_sf(data = id_counties, fill = "white", color = "black") +  # Counties as base layer
  # geom_sf(data = us_states, aes(fill = name), color = "black") +  # States with fill based on state name
  geom_sf(data = us_cities_top3, aes(color = population), size = 3)   # Cities with color based on population
  
```

```{r}
geom_sf(data = idaho, fill = "transparent", color = "blue", size = 2) +  # Highlight Idaho state
  scale_color_gradient(low = "lightblue", high = "darkblue") +    # Color scale for city population
  coord_sf(crs = st_crs(us_states)) +  # Set coordinate system
  theme_bw() +
  labs(title = "US Cities and Counties",
       subtitle = "Top 3 Cities by Population Highlighted",
       color = "Population")  # Labels and titles
```


